#!/bin/bash
# Standalone mount worker
set -euo pipefail

CLONE_BASE=""

while [[ $# -gt 0 ]]; do
  case $1 in
    --clone-base)
      CLONE_BASE="$2"; shift; shift ;;
    *)
      echo "Usage: $0 --clone-base <pool/fs>" >&2
      exit 1;;
  esac
done

if [ -z "$CLONE_BASE" ]; then echo "Error: --clone-base is required." >&2; exit 1; fi

log() { echo "[$(date -Iseconds)] [zfs-fd-mount] $1" >&2; }

log "Mounting all filesystems under $CLONE_BASE"
zfs set canmount=on "$CLONE_BASE"
zfs mount -a

# Return the primary mountpoint of the clone base
zfs get -H -o value mountpoint "$CLONE_BASE"

